define("bundles/content-feedback/components/CourseRatingsPreviewBox",["require","exports","module","q","moment","react-with-addons","bundles/phoenix/components/Modal","lazy!bundles/content-feedback/components/CourseRatingsDashboard","bundles/content-feedback/components/rating/CourseRatingHeader","./rating-dashboard/AverageCourseRating","bundles/content-feedback/models/CourseRatingStats","bundles/content-feedback/utils/CourseRatingAPIUtils","i18n!nls/content-feedback","css!./__styles__/CourseRatingsPreviewBox"],function(require,exports,module){"use strict";function _defaults(e,r){for(var s=Object.getOwnPropertyNames(r),t=0;t<s.length;t++){var n=s[t],o=Object.getOwnPropertyDescriptor(r,n);o&&o.configurable&&void 0===e[n]&&Object.defineProperty(e,n,o)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var n=function(){function defineProperties(o,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=function get(s,c,u){var n=!0;e:for(;n;){var t=s,a=c,i=u;n=!1,null===t&&(t=Function.prototype);var e=Object.getOwnPropertyDescriptor(t,a);if(void 0===e){var o=Object.getPrototypeOf(t);if(null===o)return void 0;s=o,c=a,u=i,n=!0,e=o=void 0;continue e}if("value"in e)return e.value;var r=e.get;if(void 0===r)return void 0;return r.call(i)}},p=require("q"),r=require("moment"),e=require("react-with-addons"),a=require("bundles/phoenix/components/Modal"),i=require("lazy!bundles/content-feedback/components/CourseRatingsDashboard"),s=require("bundles/content-feedback/components/rating/CourseRatingHeader"),c=require("./rating-dashboard/AverageCourseRating"),u=require("bundles/content-feedback/models/CourseRatingStats"),l=require("bundles/content-feedback/utils/CourseRatingAPIUtils"),t=require("i18n!nls/content-feedback");require("css!./__styles__/CourseRatingsPreviewBox");var d=21,h=function InsufficientData(){return e.createElement("div",{className:"rc-CourseRatingsPreviewBox"},e.createElement("h5",{className:"headline-2-text"},t("Course Ratings")),e.createElement("p",null,t("This course just launched, so we donâ€™t yet have enough data to show ratings.")))},f=function(r){function CourseRatingsVariant(){_classCallCheck(this,CourseRatingsVariant),o(Object.getPrototypeOf(CourseRatingsVariant.prototype),"constructor",this).apply(this,arguments),this.state={showModal:!1}}return _inherits(CourseRatingsVariant,r),n(CourseRatingsVariant,[{key:"componentDidMount",value:function componentDidMount(){var e=this;i(function(t){return e.setState({CourseRatingsDashboardContent:t})})}},{key:"render",value:function render(){var n=this,o=this.state.CourseRatingsDashboardContent;return e.createElement("div",{className:"rc-CourseRatingsPreviewBox"},e.createElement("h5",{className:"headline-2-text"},t("Course Ratings")),e.createElement(c,{courseRatingStats:this.props.ratingStats,showCount:!0}),e.createElement("a",{onClick:function(){return n.setState({showModal:!0})},className:"reviews-link"},t("Show all reviews")),o&&this.state.showModal&&e.createElement(a,{modalName:"course-ratings-modal",handleClose:function(){return n.setState({showModal:!1})},allowClose:!0},e.createElement(s,{openCourse:this.props.course}),e.createElement(o,{courseId:this.props.course.id,scrollContainer:".rc-Modal .c-modal-content",showTeachDescription:!1})))}}],[{key:"propTypes",value:{course:e.PropTypes.object.isRequired,ratingStats:e.PropTypes.object.isRequired,ratingsVariant:e.PropTypes.string.isRequired},enumerable:!0}]),CourseRatingsVariant}(e.Component),b=function(t){function CourseRatingsPreviewBox(){_classCallCheck(this,CourseRatingsPreviewBox),o(Object.getPrototypeOf(CourseRatingsPreviewBox.prototype),"constructor",this).apply(this,arguments)}return _inherits(CourseRatingsPreviewBox,t),n(CourseRatingsPreviewBox,[{key:"render",value:function render(){if(this.props.blacklisted||!this.props.ratingStats)return null;var t=r.duration(r().diff(this.props.course.get("launchedAt"))).asDays();return e.createElement("div",{className:"cozy od-container card-rich-interaction"},d>t?e.createElement(h,null):e.createElement(f,this.props))}}],[{key:"propTypes",value:{course:e.PropTypes.object.isRequired,ratingStats:e.PropTypes.object,blacklisted:e.PropTypes.bool},enumerable:!0}]),CourseRatingsPreviewBox}(e.Component),g=function(t){function CourseRatingsPreviewBoxContainer(){_classCallCheck(this,CourseRatingsPreviewBoxContainer),o(Object.getPrototypeOf(CourseRatingsPreviewBoxContainer.prototype),"constructor",this).apply(this,arguments),this.state={ratingStats:null,blacklisted:!1}}return _inherits(CourseRatingsPreviewBoxContainer,t),n(CourseRatingsPreviewBoxContainer,[{key:"componentWillMount",value:function componentWillMount(){var e=this,t=this.props.course&&this.props.course.id;p(l.getRatingStats(t)).then(function(t){return e.setState({ratingStats:new u(t)})})["catch"](function(){return e.setState({blacklisted:!0})}).done()}},{key:"render",value:function render(){return this.state&&(this.state.ratingStats||this.state.blacklisted)?e.createElement(b,{ratingStats:this.state.ratingStats,blackListed:this.state.blackListed,course:this.props.course}):null}}],[{key:"propTypes",value:{course:e.PropTypes.object.isRequired},enumerable:!0}]),CourseRatingsPreviewBoxContainer}(e.Component);module.exports=g});