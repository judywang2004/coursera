define("bundles/reply-message/components/ReplyMessage",["require","exports","module","underscore","moment","react-with-addons","js/lib/coursera.react-intl","bundles/phoenix/template/models/userIdentity","bundles/phoenix/components/CMLEditor","bundles/phoenix/constants/CMLEditorBlocks","bundles/teach-course/components/Checkbox","bundles/reply-message/constants/ReplyMessageConstants","bundles/reply-message/utils/ReplyMessageAPIUtils","i18n!nls/reply-message","css!./__styles__/ReplyMessage"],function(require,exports,module){"use strict";function _defaults(e,a){for(var l=Object.getOwnPropertyNames(a),t=0;t<l.length;t++){var s=l[t],n=Object.getOwnPropertyDescriptor(a,s);n&&n.configurable&&void 0===e[s]&&Object.defineProperty(e,s,n)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var m=function(){function defineProperties(n,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(e,t,s){return t&&defineProperties(e.prototype,t),s&&defineProperties(e,s),e}}(),y=function get(l,i,c){var s=!0;e:for(;s;){var t=l,o=i,r=c;s=!1,null===t&&(t=Function.prototype);var e=Object.getOwnPropertyDescriptor(t,o);if(void 0===e){var n=Object.getPrototypeOf(t);if(null===n)return void 0;l=n,i=o,c=r,s=!0,e=n=void 0;continue e}if("value"in e)return e.value;var a=e.get;if(void 0===a)return void 0;return a.call(r)}},_=require("underscore"),l=require("moment"),e=require("react-with-addons"),c=require("js/lib/coursera.react-intl"),a=c.FormattedMessage,g=c.FormattedHTMLMessage,b=require("bundles/phoenix/template/models/userIdentity"),p=require("bundles/phoenix/components/CMLEditor"),t=require("bundles/phoenix/constants/CMLEditorBlocks"),u=require("bundles/teach-course/components/Checkbox"),o=require("bundles/reply-message/constants/ReplyMessageConstants"),d=o.EntryTypes,s=o.States,i=require("bundles/reply-message/utils/ReplyMessageAPIUtils"),n=require("i18n!nls/reply-message");require("css!./__styles__/ReplyMessage");var h=[t.H1,t.H2,t.H3,t.Divider,t.Bold,t.Italic,t.Underline,t.Divider,t.Link],r={definition:{dtdId:"email/1",value:"<co-content></co-content>"}},f=function(t){function ReplyMessage(){var e=this;_classCallCheck(this,ReplyMessage),y(Object.getPrototypeOf(ReplyMessage.prototype),"constructor",this).apply(this,arguments),this.state={isMessageBoxOpen:!1,replyState:s.Idle,allowReply:!0,sentTime:null,message:r},this.handleClose=function(){e.setState({isMessageBoxOpen:!1})},this.handleSend=function(){var t=e.props,n=t.entryType,a=t.entryId,l=e.state.allowReply;e.setState({replyState:s.InProgress}),i.sendMessage(n,a,!l,e.state.message).then(function(){e.setState({replyState:s.Success,message:r,sentTime:Date.now()}),e.handleClose()})},this.handleButtonClick=function(){e.setState({isMessageBoxOpen:!0}),i.getSentMessage(e.props.entryId).then(function(t){if(!_(t.elements).isEmpty()){var n=t.elements[0].metadata;e.setState({replyState:s.Success,sentTime:n.updatedAt})}})},this.handleMessageChange=function(t){e.setState({message:t})},this.handleAllowReply=function(t){e.setState({allowReply:t})}}return _inherits(ReplyMessage,t),m(ReplyMessage,[{key:"render",value:function render(){var d=this.props,f=d.placeholder,y=d.buttonText,t=this.state,r=t.isMessageBoxOpen,m=t.allowReply,o=t.replyState,c=t.sentTime,v=t.message,i=o===s.InProgress;return e.createElement("div",{className:"rc-ReplyMessage"},r&&e.createElement("div",null,o===s.Success&&e.createElement("div",{className:"sent-reply-timestamp"},e.createElement(a,{message:n("Reply sent {time}"),time:l(c).format("lll")})),e.createElement(p,{cml:v,isFocused:!0,blocks:h,placeholder:f,onChange:this.handleMessageChange}),e.createElement("footer",{className:"send-message-footer"},e.createElement("span",{className:"send-options"},e.createElement("label",null,e.createElement(u,{onChange:this.handleAllowReply,checked:m}),e.createElement(g,{message:n("Allow learner to reply to you at <strong>{email}</strong>"),email:b.get("email_address")}))),e.createElement("button",{className:"link-styled-button cancel-button",onClick:this.handleClose},n("Cancel")),e.createElement("button",{disabled:i,className:"teach-btn teach-btn-primary",onClick:this.handleSend},n(i?"Sending...":"Send")))),!r&&e.createElement("button",{className:"link-styled-button",onClick:this.handleButtonClick},o===s.Success&&e.createElement(a,{message:n("Reply sent {time}"),time:l(c).format("lll")}),o!==s.Success&&y))}}],[{key:"propTypes",value:{entryId:e.PropTypes.any.isRequired,entryType:e.PropTypes.oneOf(_(d).toArray()).isRequired,placeholder:e.PropTypes.string,buttonText:e.PropTypes.string,title:e.PropTypes.string},enumerable:!0},{key:"defaultProps",value:{placeholder:n("Write a message"),buttonText:n("Reply")},enumerable:!0}]),ReplyMessage}(e.Component);module.exports=f});