define("bundles/ondemand/components/discussionPrompt/DiscussionPromptComponents",["require","exports","module","react-with-addons","react-router","i18n!nls/ondemand","underscore","q","bundles/phoenix/lib/apiWrapper","jsuri","bundles/phoenix/template/models/userIdentity","bundles/discussions/utils/discussionsUrl","bundles/iconfont/Icon","js/lib/getPropsFromPromise","js/lib/waitFor","bundles/discussions/components/repliesList/ReplyCMLInput","bundles/ondemand/components/ProfileImageUploader","bundles/phoenix/components/ProfileImage","bundles/discussions/utils/threadUtils"],function(require,exports,module){"use strict";function _defaults(e,o){for(var s=Object.getOwnPropertyNames(o),t=0;t<s.length;t++){var n=s[t],r=Object.getOwnPropertyDescriptor(o,n);r&&r.configurable&&void 0===e[n]&&Object.defineProperty(e,n,r)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var n=function(){function defineProperties(r,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),r=function get(s,u,l){var n=!0;e:for(;n;){var t=s,i=u,a=l;n=!1,null===t&&(t=Function.prototype);var e=Object.getOwnPropertyDescriptor(t,i);if(void 0===e){var r=Object.getPrototypeOf(t);if(null===r)return void 0;s=r,u=i,l=a,n=!0,e=r=void 0;continue e}if("value"in e)return e.value;var o=e.get;if(void 0===o)return void 0;return o.call(a)}},e=require("react-with-addons"),c=require("react-router"),P=c.Link,t=require("i18n!nls/ondemand"),_=require("underscore"),o=require("q"),a=require("bundles/phoenix/lib/apiWrapper"),i=require("jsuri"),l=require("bundles/phoenix/template/models/userIdentity"),p=require("bundles/discussions/utils/discussionsUrl"),u=p.buildUrlForDiscussionPrompt,d=require("bundles/iconfont/Icon"),m=require("js/lib/getPropsFromPromise"),b=require("js/lib/waitFor"),f=require("bundles/discussions/components/repliesList/ReplyCMLInput"),y=require("bundles/ondemand/components/ProfileImageUploader"),h=require("bundles/phoenix/components/ProfileImage"),g=require("bundles/discussions/utils/threadUtils"),v=g.formatCount,s=4,w=function(t){function RespondedLearnersImage(){var e=this;_classCallCheck(this,RespondedLearnersImage),r(Object.getPrototypeOf(RespondedLearnersImage.prototype),"constructor",this).apply(this,arguments),this.state={images:[]},this.receiveReponderImages=function(t){var n=t.linked["profiles.v0"];e.setState({images:n.map(function(e){return{image:e.photoUrl,name:e.fullName}})})}}return _inherits(RespondedLearnersImage,t),n(RespondedLearnersImage,[{key:"componentWillMount",value:function componentWillMount(){if(this.props.responseCount){var e=a("/api/onDemandDiscussionAnswers.v1/",{type:"rest"}),t=(new i).addQueryParam("q","byQuestion").addQueryParam("questionId",this.props.questionId).addQueryParam("sort","createdAtDesc").addQueryParam("limit",s).addQueryParam("includes","creatorId,_links");o(e.get(t.toString())).then(this.receiveReponderImages).done()}}},{key:"renderMorePeopleImage",value:function renderMorePeopleImage(){if(this.props.responseCount>s){var t=v(this.props.responseCount-s,!0);return e.createElement("li",{className:"bgcolor-black-g3"},e.createElement("div",{className:"horizontal-box align-items-absolute-center num-responder-images caption-text"},"+",t))}return null}},{key:"render",value:function render(){return e.createElement("div",null,this.state.images.length>0&&e.createElement("ul",{className:"nostyle horizontal-box align-items-absolute-center learner-image-list"},this.state.images.map(function(t){return e.createElement("li",null,e.createElement(h,{profileImageUrl:t.image,fullName:t.name,width:32,height:32}))}),this.renderMorePeopleImage()))}}],[{key:"propTypes",value:{questionId:e.PropTypes.string.isRequired,responseCount:e.PropTypes.number.isRequired},enumerable:!0}]),RespondedLearnersImage}(e.Component),I=function(o){function Input(){_classCallCheck(this,Input),r(Object.getPrototypeOf(Input.prototype),"constructor",this).apply(this,arguments)}return _inherits(Input,o),n(Input,[{key:"render",value:function render(){return e.createElement("div",{className:"horizontal-box align-items-left theme-light c-prompt-card"},e.createElement(y,null),e.createElement("div",{className:"flex-1"},e.createElement(f,{savingState:this.props.savingState,parentPost:this.props.question,hideToolbar:!0,viewContext:this.props.questionViewContext,placeholder:t(this.props.placeholder)})))}}],[{key:"propTypes",value:{placeholder:e.PropTypes.string.isRequired,questionViewContext:e.PropTypes.object.isRequired,question:e.PropTypes.object.isRequired,savingState:e.PropTypes.string.isRequired},enumerable:!0}]),Input}(e.Component),O=function(o){function Saving(){_classCallCheck(this,Saving),r(Object.getPrototypeOf(Saving.prototype),"constructor",this).apply(this,arguments)}return _inherits(Saving,o),n(Saving,[{key:"render",value:function render(){return e.createElement("div",{className:"horizontal-box align-items-absolute-center bgcolor-white c-prompt-card color-hint-text"},e.createElement(d,{name:"spinner",className:"cif-spin"}),e.createElement("span",{className:"caption-text"},t("Submitting Your Response")))}}]),Saving}(e.Component),x=function(o){function Completed(){_classCallCheck(this,Completed),r(Object.getPrototypeOf(Completed.prototype),"constructor",this).apply(this,arguments)}return _inherits(Completed,o),n(Completed,[{key:"render",value:function render(){return e.createElement("div",{className:"vertical-box align-items-absolute-center bgcolor-white c-prompt-card"},e.createElement("span",{className:"color-secondary-text"},t("Your response has been submitted. Engage and discuss with other learners below!")),this.props.url&&e.createElement("button",{className:"secondary c-prompt-link-button"},e.createElement(P,{className:"nostyle",to:this.props.url},t("View My Response"))))}}],[{key:"propTypes",value:{showLink:e.PropTypes.bool,questionId:e.PropTypes.string,url:e.PropTypes.string},enumerable:!0}]),Completed}(e.Component);module.exports={Input:I,Saving:O,Completed:_.compose(m(function(e){if(e.showLink){var t=a("/api/onDemandDiscussionAnswers.v1/",{type:"rest"}),n=(new i).addQueryParam("q","byQuestionAndUser").addQueryParam("questionId",e.questionId).addQueryParam("userId",l.get("id")).addQueryParam("includes","creatorId,flagId,_links").addQueryParam("sort","createdAtAsc").toString();return o(t.get(n)).then(function(e){return{url:u(e.elements[0].id)}})}return o({url:void 0})}),b(function(e){return e.url}))(x),RespondedLearnersImage:w}});